@model Machete.Domain.WorkAssignment
@using Machete.Web.Resources
@{    
    string recType = "assignment";  
}
@using (Html.BeginForm("Create", "WorkAssignment", FormMethod.Post,
                        new { @id = "workAssignmentCreateForm-wo-" + Model.workOrderID}))
{
        <input type="submit" id="workAssignmentCreateButton-wo-@(Model.workOrderID)"
               value="@WorkAssignments.createsubmit" tabindex="9"/>
        @Html.ValidationSummary(true)
        @Html.EditorForModel()
}
<script language="javascript" type="text/javascript">
    $(document).ready(function () {
        $('#activateWorkOrderButton-@(Model.workOrderID)').hide();
        //jquery'ify the buttons
        $('#workAssignmentCreateButton-wo-@(Model.workOrderID)').button();
        //Run MS validation on dynamic content
        M_createAssignmentForm_@(Model.workOrderID) = $('#workAssignmentCreateForm-wo-@(Model.workOrderID)');
        $.validator.unobtrusive.parseDynamicContent('#workAssignmentCreateForm-wo-@(Model.workOrderID)');
        // Find tabindex attribute (for tab order, not jquery tabs) and increment by 10
        $('#workAssignmentCreateForm-wo-@(Model.workOrderID) [tabindex]').each(function () {
            $(this).attr('tabindex', parseInt($(this).attr('tabindex')) + 20) 
        });
        ////////////////////////////////////////////////////////////////
        //
        //
        //
//        if ($('#hourlyWage').text() == "0") {
//            parseSkillsDD(M_createAssignmentForm_@(Model.workOrderID));
//        }
        //
        // update earnings info based on skill
        $('#workAssignmentCreateForm-wo-@(Model.workOrderID)').mUI('waFormConfiguration');
        //$('#workAssignmentCreateForm-wo-@(Model.workOrderID)').find('#skillID').bind('change', function () { parseSkillsDD(M_createAssignmentForm_@(Model.workOrderID)) });
        // show total estimated earnings for assignment
        //waEstimateEarnings(M_createAssignmentForm_@(Model.workOrderID));
//        $('#workAssignmentCreateForm-wo-@(Model.workOrderID)').find('.earnings-part').bind('change', function () { 
//                waEstimateEarnings(M_createAssignmentForm_@(Model.workOrderID)); 
//        });
        ////////////////////////////////////////////////////////////////
        //
        // WorkOrder Create submit event
        //
        $('#workAssignmentCreateForm-wo-@(Model.workOrderID)').submit(function (e) {
            if ($("#workAssignmentCreateForm-wo-@(Model.workOrderID)").valid()) {
                e.preventDefault();
                $.post($(this).attr("action"), $(this).serialize(),
                    function (data) {                        
                        add_rectab(data.sNewRef, data.sNewLabel, M_assignmentTabs_@(Model.workOrderID), false, data.iNewID, "@(recType)");
                    }
                );
            }
            //TODO: javascript...need to deal with ajax error

        });
    });

</script>