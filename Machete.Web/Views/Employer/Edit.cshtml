@model Machete.Domain.Employer
@using Machete.Web.Helpers
@using Machete.Web.Resources
@{
    System.Globalization.CultureInfo CI = (System.Globalization.CultureInfo)Session["Culture"];
    string recType = "employer";
}
@using (Html.BeginForm("Edit", "Employer", FormMethod.Post, 
                        new { @class = "edittab-form EditPost", @id="EmployerTab-" + Model.ID }))
{
    <input type="button" value="@Employers.viewlink" class="formButton" id="viewEmployer-@Model.ID" />
    <input type="submit" value="@Employers.editsubmit" class="formButton"/>
    if (Html.IsInRole(Html.Role_AM()))
    {
        <input id="deleteEmployerButton-@Model.ID" type="button" value="@Employers.deletesubmit" 
                class="formButton deleteButton" />
    }
    <br />    
    @Html.ValidationSummary(true)
    @Html.EditorForModel()

}
@if (Html.IsInRole(Html.Role_AM()))
{
    //
    // Only Managers can delete employer records
    // The phonedesk can edit and save
    //
    using (Html.BeginForm("Delete", "Employer", FormMethod.Post, 
                            new { @class = "edittab-form DeletePost", @id = "DeleteEmployer-" + Model.ID }))
    {
        @Html.HiddenFor(model => model.ID);
    }
}
@Html.Partial("WorkOrderIndex", Model)
<script language="javascript" type="text/javascript">
    $(document).ready(function () {
        $('#viewEmployer-@Model.ID').click(function () {
            printwindow = window.open('/Employer/View/@Model.ID');
        });
        $('.formButton').button();
        $('#employerName').focus();
        //
        // machete UI detect changes on forms in tabs
        //
        $("#EmployerTab-@(Model.ID)").mUI('formDetectChanges');
        //
        // validation for elements added after page load
        //
        $.validator.unobtrusive.parseDynamicContent($('#EmployerTab-@Model.ID'));
        //
        // delete button confirmation
        $("#deleteEmployerButton-@Model.ID").mUI('formClickDelete', {
            ok: "@Employers.deletesubmit",
            confirm: '@Employers.deleteconfirmation',
            title: '@Employers.deletetitle',
            form: $('#DeleteEmployer-@Model.ID')
        });
        //        $("#deleteEmployerButton-@Model.ID").click(function (event) {
        //            $.alerts.okButton = "@Employers.deletesubmit";
        //            jConfirm('@Employers.deleteconfirmation',
        //                     '@Employers.deletetitle',
        //                     function (r) {
        //                         if (r == true) {
        //                             //alert("delete submitted");
        //                             $('#DeleteEmployer-@Model.ID').submit();
        //                         }
        //                     }
        //             );
        //        });
        ////////////////////////////////////////////////////////////////
        //
        // edit form submit
        //
        $('#EmployerTab-@Model.ID').mUI('formSubmit', {
            selectTab: 0
        });
//        $('#EmployerTab-@Model.ID').submit(function (e) {
//            if ($('#EmployerTab-@Model.ID').valid()) {
//                $.post($(this).attr("action"), $(this).serialize());
//                $(e.target).closest('.ui-tabs').tabs("select", 0);
//            }

//            //TODO: javascript...need to deal with ajax error
//            e.preventDefault();
//        });
        ////////////////////////////////////////////////////////////////
        //
        // Delete employer submit 
        //
        //        $("#DeleteEmployer-@Model.ID").submit(function (e) {
        //            $.post($(this).attr("action"), $(this).serialize());
        //            //
        //            //trigger close even
        //            var oTabs = $(e.target).closest('.ui-tabs');
        //            $(oTabs).find('.ui-state-active').find('span.ui-icon-close').click();
        //            //TODO: javascript...need to deal with ajax error
        //            e.preventDefault();
        //        });
    });
</script>