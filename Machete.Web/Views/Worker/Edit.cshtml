@model Machete.Domain.Worker
@using Machete.Web.Resources
@using Machete.Web.Helpers


@using (Html.BeginForm("Edit", "Worker", FormMethod.Post,
                    new { @class = "edittab-form EditPost", 
                          @id = "workderEditTab-" + Model.ID, 
                          enctype = "multipart/form-data" }))
{
    <input type="button" value="@Workers.printlink" class="formButton" id="viewWorker-@(Model.ID)" />
    <input type="submit" value="@Workers.editsubmit" class="formButton"/>
    
    if (Html.IsInRole(Html.Role_AM()))
    {
        <input id="deleteWorkerButton-@(Model.ID)" type="button" value="@Workers.deletesubmit" 
                class="formButton deleteButton" />
    }
    <br />  
    @Html.ValidationSummary(true)
    @Html.EditorForModel()

}

@if (Html.IsInRole(Html.Role_AM()))
{
    using (Html.BeginForm("Delete", "Worker", FormMethod.Post,
                            new { @class = "edittab-form DeletePost", @id = "deleteWorker-" + Model.ID }))
    {
        @Html.HiddenFor(model => model.ID);
    }
}

<script language="javascript" type="text/javascript">
    $(document).ready(function () {
        M_WorkerEditForm_@(Model.ID) = $('#workderEditTab-@Model.ID');
        $('.formButton').button();
        $('#workderEditTab-@Model.ID').ajaxForm({
            success: function() {                       
                        $('#workderEditTab-@Model.ID').closest('.ui-tabs').tabs("select", 0);
                     }
        });
        //TODO: Tab order $('#contactName').focus();
        $.validator.unobtrusive.parseDynamicContent(M_WorkerEditForm_@(Model.ID));
                ////////////////////////////////////////////////////////////////
        //
        // open work order view for printing
        //
        $('#viewWorker-@(Model.ID)').click(function () {
            printwindow = window.open('/Worker/View/@(Model.ID)');
            //printwindow.print();
        });

        ////////////////////////////////////////////////////////////////
        //
        // Confirm delete event
        //
        $("#deleteWorkerButton-@(Model.ID)").click(function () {
            jConfirm('@Workers.deleteconfirmation',
                     '@Workers.deletetitle',
                     function (r) {
                         if (r == true) {
                             $('#deleteWorker-@(Model.ID)').submit();
                         }
                     }
                    );
        });
        ////////////////////////////////////////////////////////////////
        //
        // submit edit
        //
//        $('#workderEditTab-@Model.ID').submit(function (e) {
//            if ($('#workderEditTab-@Model.ID').valid()) {
//                //$.post($(this).attr("action"), $(this).serialize());
//                $(e.target).closest('.ui-tabs').tabs("select", 0);
//            }
//            //TODO: javascript...need to deal with ajax error
//            //e.preventDefault();
//        });
        ////////////////////////////////////////////////////////////////
        //
        // submit delete
        //
        $("#deleteWorker-@(Model.ID)").submit(function (e) {
            e.preventDefault();
            $.post($(this).attr("action"), $(this).serialize());
            //var oTabs = $(e.target).closest('.ui-tabs').children('.ui-tabs-nav');
            //$(oTabs).find('.ui-state-active').find('span.ui-icon-close').click();
            //TODO: javascript...need to deal with ajax error
            //alert("foo");
            var oTabs = $(e.target).closest('.ui-tabs');
            $(oTabs).tabs("select", 0);            
            var edittab = $(oTabs).children('.ui-tabs-nav').find('a').get('1');
            $(oTabs).tabs("url", 1, "/Worker/Create?ID=@(Model.ID)");
            $(edittab).text('edit changed the name');
            
            //alert("foo2");
        });
    });
</script>