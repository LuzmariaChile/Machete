@model Machete.Web.ViewModel.WorkerSigninViewModel
@using Machete.Web.Resources
@using Machete.Domain.Resources
<link href="@Url.Content("~/Content/print.css")" rel="stylesheet" type="text/css" media="print" />
@{
    ViewBag.Title = WorkerSignins.indextitle;
    System.Globalization.CultureInfo CI = (System.Globalization.CultureInfo)Session["Culture"];
}
@*<h2 class="print_off">@WorkerSignins.indextitle</h2>*@
<div id="container">
        <div id="signinData" class="signinColumn" style="float: left;">
            <div id="signinForm" class="print_off">
            @using (Html.BeginForm())
            {
                @Html.ValidationSummary(true)
                <div class="editor-label">
                    @Html.LabelFor(model => model.dwccardentry)
                </div>
                <div class="editor-field">
                    @Html.TextBox("dwccardentry", "", new {style="width: 100px;" })
                    @Html.ValidationMessageFor(model => model.dwccardentry)
                </div>
                <div class="editor-field">
                    @Html.TextBox("dateforsignin",
                        Html.Encode(String.Format("{0:mm/dd/yy}", Model.dateforsignin.ToShortDateString())),
                        new { @class = "ui-datepicker", style="width: 100px;" })
                    @Html.ValidationMessageFor(model => model.dateforsignin)
                </div>
                <div class="">
                <p>
                    <input type="submit" value="@WorkerSignins.indexsubmit" />
                </p>   
                </div>
            }
            </div>
            <div id="signinTable">
            <table id="myDataTable" class="display">
                <thead>
                <tr>
                    <th class="print_off"></th>
                    <th>@Worker.dwccardnum</th>
                    <th>@Person.firstname1</th>
                    <th class="print_off">@Person.firstname2</th>
                    <th>@Person.lastname1</th>
                    <th class="print_off">@Person.lastname2</th>
                    <th class="print_off">@WorkerSignins.datesignin</th>
                </tr>
                </thead>
                @foreach (var item in Model.workersignins)
                {
                    <tr>
                        <td class="print_off">@Html.ActionLink(@WorkerSignins.deletelink,
                                             "Delete",
                                             new { id = item.signinID },
                                             new { @class = "confirm_delete" })
                        </td>
                        <td>@item.dwccardnum</td>
                        <td>@item.firstname1</td>
                        <td class="print_off">@item.firstname2</td>
                        <td>@item.lastname1</td>
                        <td class="print_off">@item.lastname2</td>
                        <td class="print_off">@String.Format("{0:MM/dd/yyyy}", item.dateforsignin)</td>
                    </tr>
                }
            </table>
            </div>
        </div>
        <div id="signinImage" class="signinColumn print_off" style="float: left; width: 200px">
            <p>
            @Html.Encode(WorkerSignins.expirationdate + String.Format("{0:mm/dd/yyyy}", Model.last_chkin_memberexpirationdate.ToString()))
            </p>
            @if (Model.memberexpired)
            {
                <div style="color: red;">
                <p><strong>@Html.Encode(WorkerSignins.membershipexpiredmessage)</strong></p>
                </div>
            }
            @if (Model.last_chkin_image.ImageData == null)
            {
                <p>
                    @Html.Label(WorkerSignins.noimage)
                </p>
            }
            else
            {
                <img src="@Url.Action("GetImage", "Image", new { Model.last_chkin_image.ID })" alt="" style="width: 200px"/>
            }
        </div>
</div>


<script type="text/javascript">
    $().ready(function () {
        DatePicker();
        SigninFocus();
        MyTable();
        $('.confirm_delete').click(function (event) { Confirm_button(event, this); });
        //$('#confirm_delete').click(function (event) { event.preventDefault(); });
    });
    function DatePicker() {
        $('.ui-datepicker').datepicker({
            dateFormat: 'mm/dd/yy',
            buttonImage: '@Url.Content("~/Content/calendar.gif")',
            buttonImageOnly: true,
            showOn: "button",
            onClose: function () { SigninFocus(); }
        });
    }
    function SigninFocus() {
        $('#dwccardentry').focus();
    }
    function MyTable() {
        $('#myDataTable').dataTable({
            "bPaginate": true,
            "bLengthChange": true,
            "bFilter": true,
            "bSort": true,
            "bInfo": true,
            "bAutoWidth": false,
            "oLanguage": datatable_lang_@(CI.TwoLetterISOLanguageName),
            "iDisplayLength": -1,
            "aLengthMenu": [[25, 50, 100, -1], [25, 50, 100, "@WorkerSignins.allrecords"]]
        });
        $('.dataTables_length').addClass('print_off');
        $('.dataTables_filter').addClass('print_off');
        $('.dataTables_info').addClass('print_off');
    }
    function Confirm_button(e, t) {
        e.preventDefault();
        var theHref =  $(t).attr('href');
        $.alerts.okButton = "@WorkerSignins.deletesubmit";
        jConfirm('@WorkerSignins.deleteconfirmation',
                     '@WorkerSignins.deletetitle',
                     function (r) {
                         if (r == true) { window.location = theHref; }
                     });
                     return false;
    }
</script>