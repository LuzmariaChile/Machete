@using Machete.Web.Helpers
@using Machete.Domain.Resources
@using Machete.Web.Resources
@using Machete.Service
@Scripts.Render("~/bundles/reports")

@{
    System.Globalization.CultureInfo CI = (System.Globalization.CultureInfo)Session["Culture"];
}
<div id="reportTabs">
    <ul>
        <li><a href="#summaryWrapper" id="summaryTab">@Machete.Web.Resources.Reports.summaryTab</a> </li>
        <li><a href="#workersWrapper" id="workersTab">@Machete.Web.Resources.Reports.workersTab</a> </li>
        <li><a href="#activityWrapper" id="activityTab">@Machete.Web.Resources.Reports.activitiesTab</a> </li>
        <li><a href="#ssrsWrapper" id="ssrsTab">@Machete.Web.Resources.Reports.ssrsTab</a> </li>
    </ul>
        @Html.Partial("Summary")
        @Html.Partial("Workers")
        @Html.Partial("Activities")
        @Html.Partial("SSRS")
</div>
<script type="text/javascript">
    $(document).ready(function () {
        //VARS
        var dcl = $('#dclDataTable');
        var wec = $('#wecDataTable');
        var mwd = $('#mwdDataTable');
        var ywd = $('#ywdDataTable');

        var weekAct = $('#weekActDataTable');
        var monthAct = $('#monthActDataTable');
        var yearAct = $('#yearActDataTable');

        var weekWkr = $('#weekWkrDataTable');
        var monthWkr = $('#monthWkrDataTable');
        var yearWkr = $('#yearWkrDataTable');

        var lang = datatable_lang_@(CI.TwoLetterISOLanguageName);

        // hide stuff 
        // 
        $('.report-instructions-show').hide();
        $('.report-instructions-show').click(
            function () {
                $('.report-instructions-show').hide();
                $('.report-instructions').show();
            });
        $('.report-instructions-hide').click(
            function () {
                $('.report-instructions').hide();
                $('.report-instructions-show').show();
            });

        //$('#dclTable').hide();
        //$('#wecTable').hide();
        //$('#mwdTable').hide();
        $('.report-container').hide();

        // make stuff pretty
        //
        $('#reportTabs').tabs();
        $('.formButton').button();
        $('.report-accordion').accordion({
            collapsible: true,
            active: false,
            autoHeight: false
        });
        
        ////////////////////// | the date-pickerers |

        $.datepicker.setDefaults({
            autoSize: true,
            changeMonth: true,
            changeYear: true,
            constrainInput: true,
            dateFormat: 'mm/dd/yy',
            duration: "slow",
            showButtonPanel: false,
            showOn: "focus"
        });

        $('.report-datepicker').datepicker();

        $('.report-datepicker-weekly').datepicker({
            beforeShowDay: function (date) {
                var day = date.getDay();
                return [(day > 5), ''];
            }
        });

        // Daily datepickerer
        //
        $('#dclDate').change(function (event) { dclNewTable(); });

        // Weekly datepickerers
        //
        $('#wecDate').change(function (event) { wecNewTable(); });
        $('#weekActDate').change(function (event) { weekActNewTable(); });
        $('#weekWkrDate').change(function (event) { weekWkrNewTable(); });

        // Monthly datepickerers
        //
        $('#mwdDate').change(function (event) { mwdNewTable(); });
        $('#monthActDate').change(function (event) { monthActNewTable(); });
        $('#monthWkrDate').change(function (event) { monthWkrNewTable(); });

        // Yearly datepickerer
        //
        $('#ywdDate').change(function (event) { ywdNewTable(); });
        $('#yearActDate').change(function (event) { yearActNewTable(); })
        $('#yearWkrDate').change(function (event) { yearWkrNewTable(); });

        //////////////////////////////////////////////////////////////////////// | DATATABLES |
        //
        //  SUMMARIES (ORDERS) -- Idea is to eventually separate quick summary reports from detailed orders reports.
        //

        function dclNewTable() {
            oDclTable = $.extend(true, {}, reportTableDefaults("/Reports/AjaxDcl", lang, $('#dclDate').val()));
            oDclTable.aoColumns = [
                { mDataProp: "date" },
                { mDataProp: "dwcList" },
                { mDataProp: "dwcPropio" },
                { mDataProp: "hhhList" },
                { mDataProp: "hhhPropio" },
                { mDataProp: "uniqueSignins" },
                { mDataProp: "totalSignins" },
                { mDataProp: "totalAssignments" },
                { mDataProp: "cancelledJobs" },
            ];
            dcl = $('#dclDataTable').dataTable(oDclTable);
        }

        function wecNewTable() {
            oWecTable = $.extend(true, {}, reportTableDefaults("/Reports/AjaxWec", lang, $('#wecDate').val()));
            oWecTable.aoColumns = [
                { mDataProp: "weekday" },
                { mDataProp: "date" },
                { mDataProp: "totalSignins" },
                { mDataProp: "totalAssignments" },
                { mDataProp: "weekEstDailyHours" },
                { mDataProp: "weekEstPayment" },
                { mDataProp: "weekHourlyWage" },
                {
                    mDataProp: null,
                    sDefaultContent: '<img src="/Content/dataTables/details_open.png" class="nestedDetailsButton">'
                },
            ];
            wec = $('#wecDataTable').dataTable(oWecTable);
        }
        
        function mwdNewTable() {
            oMwdTable = $.extend(true, {}, summaryTableDefaults("/Reports/AjaxMwd", lang, $('#mwdDate').val()));
            mwd = $('#mwdDataTable').dataTable(oMwdTable);
            @*monthlyPie();*@
            }
        
        function ywdNewTable() {
            oYwdTable = $.extend(true, {}, summaryTableDefaults("/Reports/AjaxYwd", lang, $('#ywdDate').val()));
            ywd = $('#ywdDataTable').dataTable(oYwdTable);
            @*yearlyPie();*@
        }
        //
        // ACTIVITIES
        //
        function weekActNewTable() {
            oWeekActTable = $.extend(true, {}, activityTableDefaults("/Reports/AjaxWeekAct", lang, $('#weekActDate').val()));
            weekAct = $('#weekActDataTable').dataTable(oWeekActTable);
        }

        function monthActNewTable() {
            oMonthActTable = $.extend(true, {}, activityTableDefaults("/Reports/AjaxMonthAct", lang, $('#weekActDate').val()));
            monthAct = $('#monthActDataTable').dataTable(oMonthActTable);
        }

        function yearActNewTable() {
            oYearActTable = $.extend(true, {}, activityTableDefaults("/Reports/AjaxYearAct", lang, $('#weekActDate').val()));
            yearAct = $('#yearActDataTable').dataTable(oYearActTable);
        }
        //
        // WORKERS
        //
        function weekWkrNewTable() {
            oWeekWkrTable = $.extend(true, {}, workerTableDefaults("/Reports/AjaxWeekWkr", lang, $('#weekWkrDate').val()));
            weekWkr = $('#weekWkrDataTable').dataTable(oWeekWkrTable);
        }

        function monthWkrNewTable() {
            oMonthWkrTable = $.extend(true, {}, workerTableDefaults("/Reports/AjaxMonthWkr", lang, $('#monthWkrDate').val()));
            monthWkr = $('#monthWkrDataTable').dataTable(oMonthWkrTable);
        }

        function yearWkrNewTable() {
            oYearWkrTable = $.extend(true, {}, workerTableDefaults("/Reports/AjaxYearWkr", lang, $('#yearWkrDate').val()));
            yearWkr = $('#yearWkrDataTable').dataTable(oYearWkrTable);
        }

        ////////////////////////////////////////////////////////////// | DRILLDOWNS |
        ////////////////////////////////////////////////////////////// | [+] [-]... |

        // SUMMARY
        //
        $('#wecDataTable tbody td img').live('click', function () {
            var nTr = $(this).parents('tr')[0];

            if (wec.fnIsOpen(nTr)) {
                /* This row is already open - close it */
                this.src = "/Content/dataTables/details_open.png";
                wec.fnClose(nTr);
            } else {
                /* Open this row */
                this.src = "/Content/dataTables/details_close.png";
                wec.fnOpen(nTr, fnFormatWeekDetails(wec, nTr), 'nestedDetails');
            }
        });

        $('#mwdDataTable tbody td img').live('click', function () {
            var nTr = $(this).parents('tr')[0];

            if (mwd.fnIsOpen(nTr)) {
                /* This row is already open - close it */
                this.src = "/Content/dataTables/details_open.png";
                mwd.fnClose(nTr);
            } else {
                /* Open this row */
                this.src = "/Content/dataTables/details_close.png";
                mwd.fnOpen(nTr, fnFormatSummaryDetails(mwd, nTr), 'nestedDetails');
            }
        });

        $('#ywdDataTable tbody td img').live('click', function () {
            var nTr = $(this).parents('tr')[0];

            if (ywd.fnIsOpen(nTr)) {
                /* This row is already open - close it */
                this.src = "/Content/dataTables/details_open.png";
                ywd.fnClose(nTr);
            } else {
                /* Open this row */
                this.src = "/Content/dataTables/details_close.png";
                ywd.fnOpen(nTr, fnFormatSummaryDetails(ywd, nTr), 'nestedDetails');
            }
        });

        // ACTIVITIES
        //

        $('#weekActDataTable tbody td img').live('click', function () {
            var nTr = $(this).parents('tr')[0];

            if (weekAct.fnIsOpen(nTr)) {
                /* This row is already open - close it */
                this.src = "/Content/dataTables/details_open.png";
                weekAct.fnClose(nTr);
            } else {
                /* Open this row */
                this.src = "/Content/dataTables/details_close.png";
                weekAct.fnOpen(nTr, fnFormatActivityDetails(weekAct, nTr), 'nestedDetails');
            }
        });

        $('#monthActDataTable tbody td img').live('click', function () {
            var nTr = $(this).parents('tr')[0];

            if (monthAct.fnIsOpen(nTr)) {
                /* This row is already open - close it */
                this.src = "/Content/dataTables/details_open.png";
                monthAct.fnClose(nTr);
            } else {
                /* Open this row */
                this.src = "/Content/dataTables/details_close.png";
                monthAct.fnOpen(nTr, fnFormatActivityDetails(mwd, nTr), 'nestedDetails');
            }
        });

        $('#yearActDataTable tbody td img').live('click', function () {
            var nTr = $(this).parents('tr')[0];

            if (yearAct.fnIsOpen(nTr)) {
                /* This row is already open - close it */
                this.src = "/Content/dataTables/details_open.png";
                yearAct.fnClose(nTr);
            } else {
                /* Open this row */
                this.src = "/Content/dataTables/details_close.png";
                yearAct.fnOpen(nTr, fnFormatActivityDetails(ywd, nTr), 'nestedDetails');
            }
        });

        ///////////////////////////////////////////////////////////////////////////////// | BUTTONS |
        //
        //

        // | REFRESH |

        $('#dclDataOnlyBtn').click(
            function () {
                dclNewTable();
            });

        $('#wecDataOnlyBtn').click(
            function () {
                wecNewTable();
            });

        $('#mwdDataOnlyBtn').click(
            function () {
                mwdNewTable();
            });

        $('#ywdDataOnlyBtn').click(
            function () {
                ywdNewTable();
            });

        // | PRINT VIEWS |

        // grab these from master before merging :p

        // | SPREADSHEETS |

        // "

        //
        // ||| PIE CHARTS |||
        //

        // "

    });
</script>