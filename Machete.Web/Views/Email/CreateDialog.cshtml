@model Machete.Web.ViewModel.EmailView
@using Machete.Web.Resources

@using (Html.BeginForm("Create", "Email", FormMethod.Post, 
                        new { @id = Model.idPrefix + "emailCreateForm" }))
{
    <div>
        <input type="submit" id="@(Model.idPrefix)SaveBtn" class="formButton saveBtn" 
               value="@Emails.createsubmit"  tabindex="9"/>
        <input type="button" id="@(Model.idPrefix)attachWO" class="formButton" value="$$$attach WO" />

    </div>
    @Html.ValidationSummary(true)
    @Html.EditorForModel()

}
<script type="text/javascript">
    $(document).ready(function () {
        $('.formButton').button();
        var emailCreateForm = $("#@(Model.idPrefix)emailCreateForm")
        $.validator.unobtrusive.parseDynamicContent('#@(Model.idPrefix)emailCreateForm');
        $('#emailName').focus();
        // Email Create submit event

        emailCreateForm.mUI('tabFormSubmit', {
            recType: "@(Model.idString)", //for add_rectab
            create: true,
            formLevel: 1,
            preProcess: function () {
                var field = $('#@(Model.idPrefix)attachment');
                var encoded = $('<div/>').text($(field).val()).html();
                //console.log(encoded);
                field.val(encoded);
            },
            postProcess: function () {
                $('#@(Model.idPrefix)emailCreateForm').closest('.ui-dialog').find('a.ui-dialog-titlebar-close').click();
            }
        });
        //
        // machete UI detect changes on forms in tabs   
        emailCreateForm.mUI('formDetectChanges', {
            recType: "@(Model.idString)",
            formLevel: 1,
            changeConfirm: "@(Shared.changeConfirm)",
            changeTitle: "@(Shared.changeTitle)"
        });
        $('#@(Model.idPrefix)attachWO').mUI('btnAttachWorkOrder', {
            url: '/WorkOrder/ViewForEmail/@(Model.woid)',
            field: $('#@(Model.idPrefix)attachment')
        });
    });
</script>