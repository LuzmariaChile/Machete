@using Machete.Web.Helpers
@using Machete.Web.Resources
@using Machete.Domain.Resources
@{
    System.Globalization.CultureInfo CI = (System.Globalization.CultureInfo)Session["Culture"];
    string recType = "activity";
    //string idPrefix = recType + Model.ID + "-";
    int maxTabs = User.Identity.IsAuthenticated == true ? 2 : 1; //If auth, 2 tab limit

    //To hide JS features for unauthorized
    int authenticated = 0;
    if (User.Identity.IsAuthenticated)
    {
        authenticated = 1;
    }
    
}
<div id="activityList"> @* This div is the ui.panel  *@
    <table id="activityTable" class="display">
        <thead>
            <tr>
                <th>ID</th>
                <th>LABEL</th>
                <th>@Activity.name</th>
                <th>@Activity.type</th>
                <th>@Activity.teacher</th>
                <th>@Activities.count</th>
                <th>@Activity.dateStart</th>
                <th>@Activity.dateEnd</th>
                <th>@Record.dateupdated</th>
                <th>@Record.updatedby</th>
            </tr>
        </thead>
    </table>
</div>
<script type="text/javascript">
    $(document).ready(function () {        
        //
        // Create Activity table
        jqrfyTable({
            table: $('#activityTable'), 
            tab: $('#activityTabs'),
            options: {
                "bPaginate": true,
                "bLengthChange": true,
                "aaSorting": [[7, 'desc']],
                "bFilter": true,
                "bSort": true,
                "bInfo": true,
                "bAutoWidth": false,
                "bServerSide": true,
                "sAjaxSource": "/Activity/AjaxHandler",
                "bProcessing": true,
                "oLanguage": datatable_lang_@(CI.TwoLetterISOLanguageName),
                "aoColumns": [                           //dataTable column definition
                                {"mDataProp": "tabref",  "bSearchable": false, "bSortable": false, "bVisible": false },
                                {"mDataProp": "tablabel",  "bSearchable": false, "bSortable": false, "bVisible": false },
                                {"mDataProp": "name" },
                                {"mDataProp": "type" },
                                {"mDataProp": "teacher" },
                                {"mDataProp": "count" },
                                {"mDataProp": "dateStart" },
                                {"mDataProp": "dateEnd" },
                                {"mDataProp": "dateupdated" },
                                { "mDataProp": "Updatedby", "bSortable": false }
                            ]             
            }, 
            dblClickEvent: null, 
            tabLabel: "@(recType)",
            maxTabs: @(maxTabs)
            });

            //pagetimer for unauthorized view
            if (@(authenticated) == 0) {
                
                // Reloads Activities list after 10 minutes if class tab is left open
                var pageTimer = null;
                $('#activityTabs').bind('tabsselect', function(event, ui) { 
                    if ($(ui.tab).attr('id') == 'activityListTab') {
					    try {
                            clearTimeout(pageTimer);
                            console.log('pageTimer cleared: ' +  pageTimer);
					        pageTimer = null;
                        } catch(e) {
                            console.log('no pageTimer set');
                        }
                    } else { 
                        if (pageTimer!=null) {
                            console.log('pageTimer already exists: ' + pageTimer);
                        } else { 
                            pageTimer = setTimeout(function() {
                                window.location.href= "/Activity";
                            }, 10000);
                            console.log('pageTimer set:' + pageTimer);
                        }
                    }
                });
            }

    });
</script>

