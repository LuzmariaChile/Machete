@model Machete.Domain.Email
@using Machete.Web.Helpers
@using Machete.Web.Resources
@using Machete.Domain

@{
    System.Globalization.CultureInfo CI = (System.Globalization.CultureInfo)Session["Culture"];
    string recType = "email";
    string idPrefix = recType + Model.ID + "-";
}
@Html.HiddenFor(model => model.ID, new { @class="hiddenRecID", id=idPrefix + "ID"})
<div class="tb-table" style="float: left; clear: left;">
@*    <div class="tb-row">
        @Html.mUITableLabelAndTextBoxFor(model => model.emailFrom, 
            new {tabindex = "1", id=idPrefix + "emailFrom", @class="emailField email"})
    </div>*@
    <div class="tb-row">
        <div class="tb-label">
            @Html.Label("$$$templateLabel")
        </div>
        @if (Html.IsInRole(Html.Role_AM()) 
             && ( Model.status == Email.iPending 
                || Model.status == Email.iReadyToSend
                || Model.status == Email.iTransmitError
                )
            )
        {
            @Html.mUIDropDownListFor(model => model.status,
                                new SelectList(Lookups.get(Machete.Domain.LCategory.emailstatus, CI.TwoLetterISOLanguageName), "Value", "Text", Model.status),
                        new { @id = idPrefix + "status" })
                
        }
        else
        { 
            <div class="tb-header">
            @Lookups.byID(Model.status, CI.TwoLetterISOLanguageName)
            @Html.HiddenFor(model => model.status, new { @id = idPrefix + "status" })
            </div>
        }
    </div>
    <div class="tb-row">
        <div class="tb-label">
            @Html.Label("$$$templateLabel")
        </div>
        <div class="tb-field">
            <select name="templateChooser" id=@(idPrefix + "templateChooser")
                    tabindex="1"
                    class=""><option value="">@Shared.choose</option>
                @foreach (var item in Lookups.getEmailTemplates(CI.TwoLetterISOLanguageName))
                {
                    <option value="@(item.Value)"
                            template="@(item.template)">@item.Text</option>
                }
            </select>

        </div>
    </div>
    <div class="tb-row">
        @Html.mUITableLabelAndTextBoxFor(model => model.emailTo, 
            new {tabindex = "1", id=idPrefix + "emailTo", @class="emailField email"})
    </div><!--tb-row-->
    <div class="tb-row">
        @Html.mUITableLabelAndTextBoxFor(m => m.subject,
            new {tabindex = "1", id=idPrefix + "subject", @class="emailField"})
    </div>
    <div class="tb-row">
        @Html.mUITableLabelFor(m => m.body)
        @Html.TextAreaFor(m => m.body, new {tabindex = "1", id=idPrefix + "body", @class="emailField"})
    </div>
</div>

<div style="clear: left;"></div>
@Html.Partial("ManagerInfo", Model)
@Html.Partial("AdministratorInfo", Model)


<script type="text/javascript">
    $(document).ready(function () {
        var selectDropDown = $('#@(idPrefix + "templateChooser")');
        selectDropDown.mUI('selectDDPopulatesField', {
            attrName: 'template',
            target: $('#@(idPrefix + "body")')
        });
    });
</script>