@model Machete.Domain.WorkOrder
@using Machete.Web.Helpers
@using Machete.Web.Resources
@using Machete.Domain.Resources
@Html.HiddenFor(model => model.ID, new { @class = "hiddenRecID" })
@Html.HiddenFor(model => model.EmployerID)
@{
    System.Globalization.CultureInfo CI = (System.Globalization.CultureInfo)Session["Culture"];
}
<div class="tb-table">
    <div class="tb-row">
        <div class="tb-label tb-cell">
            @Html.LabelFor(model => model.dateTimeofWork)
        </div>
        <div class="tb-field tb-cell">
            @Html.TextBox("dateTimeofWork", Html.Encode(System.String.Format("{0:g}", Model.dateTimeofWork)), new { @id = "WO-dateTimeofWork-" + Model.ID })
            @Html.ValidationMessageFor(model => model.dateTimeofWork)
        </div>
        <div class="tb-label tb-cell">
            @Html.LabelFor(model => model.paperOrderNum)
        </div>
        <div class="tb-field tb-cell">
            @Html.TextBox("paperOrderNum", Model.paperOrderNum, new { style = "width: 5em" })
            @Html.ValidationMessageFor(model => model.paperOrderNum)
        </div>
    </div>
    <div class="tb-row">
        <div class="tb-label tb-cell">
            @Html.LabelFor(model => model.status)
        </div>
        

        @if (Html.IsInRole(Html.Role_AM()))
        {
            <div class="tb-field tb-cell">
            @Html.DropDownListFor(model => model.status, new SelectList(ViewBag.woStatuses, "Value", "Text", Model.status), @Machete.Web.Resources.Shared.choose)
            @Html.ValidationMessageFor(model => model.status)
            </div>
                
        }
        else
        {
            <div class="tb-header tb-cell">

            @Lookups.byID(Model.status, CI.TwoLetterISOLanguageName)
            @Html.HiddenFor(model => model.status)
            </div>
        }
        <div class="tb-label tb-cell" style="width: auto">
            @Html.LabelFor(model => model.timeFlexible)
        </div>
        <div class="tb-field tb-cell" style="width: 20px">
            @Html.DropDownListFor(model => model.timeFlexible, new SelectList(Lookups.yesno(CI.TwoLetterISOLanguageName), "Value", "Text", Model.timeFlexible), @Machete.Web.Resources.Shared.choose, new { tabindex = "2" })           
            @Html.ValidationMessageFor(model => model.timeFlexible)
        </div>
    </div>
    <div class="tb-row">
        <div class="tb-label tb-cell">
            @Html.LabelFor(model => model.contactName)
        </div>
        <div class="tb-field tb-cell">
            @Html.TextBoxFor(model => model.contactName, new { tabindex = "1" })
            @Html.ValidationMessageFor(model => model.contactName)
        </div>
        <div class="tb-label tb-cell">
            @Html.LabelFor(model => model.permanentPlacement)
        </div>
        <div class="tb-field tb-cell">
            @Html.DropDownListFor(model => model.permanentPlacement, new SelectList(Lookups.yesno(CI.TwoLetterISOLanguageName), "Value", "Text", Model.permanentPlacement), @Machete.Web.Resources.Shared.choose, new { tabindex = "2" })           
            @Html.ValidationMessageFor(model => model.permanentPlacement)
        </div>
    </div>
    <div class="tb-row">
        <div class="tb-label tb-cell">
            @Html.LabelFor(model => model.workSiteAddress1)
        </div>
        <div class="tb-field tb-cell">
            @Html.TextBoxFor(model => model.workSiteAddress1, new { tabindex = "1" })
            @Html.ValidationMessageFor(model => model.workSiteAddress1)
        </div>
         @*<div class="tb-label tb-cell">
            @Html.LabelFor(model => model.typeOfWorkID)
        </div>
        <div class="tb-field tb-cell">
            @Html.DropDownListFor(model => model.typeOfWorkID, new SelectList(ViewBag.typesOfWork, "Value", "Text", Model.typeOfWorkID), @Machete.Web.Resources.Shared.choose, new { tabindex = "2" })
            @Html.ValidationMessageFor(model => model.typeOfWorkID)
        </div>*@
    </div>
    <!--tb-row-->
    <div class="tb-row">
        <div class="tb-label tb-cell">
            @Html.LabelFor(model => model.workSiteAddress2)
        </div>
        <div class="tb-field tb-cell">
            @Html.TextBoxFor(model => model.workSiteAddress2, new { tabindex = "1" })
            @Html.ValidationMessageFor(model => model.workSiteAddress2)
        </div>
        <div class="tb-label tb-cell englishRequired_@(Model.ID)">
            @Html.LabelFor(model => model.englishRequired)
        </div>
        <div class="tb-field tb-cell englishRequired_@(Model.ID)">
            @Html.DropDownListFor(model => model.englishRequired, new SelectList(Lookups.yesno(CI.TwoLetterISOLanguageName), "Value", "Text", Model.englishRequired), @Machete.Web.Resources.Shared.choose, new { tabindex = "2" })
            @Html.ValidationMessageFor(model => model.englishRequired)
        </div>
    </div>
    <!--tb-row-->
    <div class="tb-row">
        <div class="tb-label tb-cell">
            @Html.LabelFor(model => model.city)
        </div>
        <div class="tb-field tb-cell">
            @Html.TextBoxFor(model => model.city, new { tabindex = "1" })
            @Html.ValidationMessageFor(model => model.city)
        </div>
        <div class="tb-label tb-cell">
            @Html.LabelFor(model => model.lunchSupplied)
        </div>
        <div class="tb-field tb-cell">
            @Html.DropDownListFor(model => model.lunchSupplied, new SelectList(Lookups.yesno(CI.TwoLetterISOLanguageName), "Value", "Text", Model.lunchSupplied), @Machete.Web.Resources.Shared.choose, new { tabindex = "2" })
            @Html.ValidationMessageFor(model => model.lunchSupplied)
        </div>

    </div>
    <!--tb-row-->
    <div class="tb-row">
        <div class="tb-label tb-cell">
            @Html.LabelFor(model => model.state)
        </div>
        <div class="tb-field tb-cell">
            @Html.TextBoxFor(model => model.state, new { tabindex = "1" })
            @Html.ValidationMessageFor(model => model.state)
        </div>
        <div class="tb-label tb-cell">
            @Html.LabelFor(model => model.transportMethodID)
        </div>
        <div class="tb-field tb-cell">
            @Html.DropDownListFor(model => model.transportMethodID, new SelectList(ViewBag.TransportMethods, "Value", "Text", Model.transportMethodID), @Machete.Web.Resources.Shared.choose, new { tabindex = "2" })
            @Html.ValidationMessageFor(model => model.transportMethodID)
        </div>
    </div>
    <!--tb-row-->
    <div class="tb-row">

    <div class="tb-label tb-cell">
            @Html.LabelFor(model => model.zipcode)
        </div>
        <div class="tb-field tb-cell">
            @Html.TextBoxFor(model => model.zipcode, new { tabindex = "1" })
            @Html.ValidationMessageFor(model => model.zipcode)
        </div>
        <div class="tb-label tb-cell">
            @Html.LabelFor(model => model.transportFee)
        </div>
        <div class="tb-field tb-cell">      
            @Html.TextBox("transportFee", Html.Encode(System.String.Format("{0:f2}", Model.transportFee)), new { tabindex = "2", @class="money-field" })
            @Html.ValidationMessageFor(model => model.transportFee)
        </div>
    </div>
    <!--tb-row-->
    <div class="tb-row">
        <div class="tb-label tb-cell">
            @Html.LabelFor(model => model.phone)
        </div>
        <div class="tb-field tb-cell">
            @Html.TextBoxFor(model => model.phone, new { tabindex = "1", id="wophone" })
            @Html.ValidationMessageFor(model => model.phone)
        </div>
        <div class="tb-label tb-cell">
            @Html.LabelFor(model => model.transportFeeExtra)
        </div>
        <div class="tb-field tb-cell">
            @Html.TextBox("transportFeeExtra", Html.Encode(System.String.Format("{0:f2}", Model.transportFeeExtra)), new { tabindex = "2", @class = "money-field" })
            @Html.ValidationMessageFor(model => model.transportFeeExtra)
        </div>
    </div>
</div><!--tb-table main workorder table-->
<div class="tb-table">
    <div class="tb-row englishNoteRow" id="englishNote_@(Model.ID)">
        <div class="tb-label tb-cell desc-label">
            @Html.LabelFor(model => model.englishRequiredNote)
        </div>
        <div class="tb-field tb-cell">
            @Html.TextAreaFor(model => model.englishRequiredNote, new { tabindex = "2", @class="desc-field" })
            @Html.ValidationMessageFor(model => model.englishRequiredNote)
        </div>
    </div>
    <div class="tb-row">
        <div class="tb-label tb-cell desc-label">
            @Html.LabelFor(model => model.workerRequests)
            <input type="button" value="@Machete.Domain.Resources.WorkOrder.requestAdd" class="formButton" id="addRequestBtn-@(Model.ID)"/>
            <input type="button" value="@Machete.Domain.Resources.WorkOrder.requestRemove" class="formButton" id="removeRequestBtn-@(Model.ID)"/>
        </div>
        <div class="tb-field tb-cell desc-field">
            @Html.ListBox("workerRequests2", new SelectList(ViewBag.workerRequests, "Value", "Text"), new { @id = "workerRequests2_WO-"+ Model.ID, tabindex = "2", @style="min-width: 8em;"})
        </div>

        <div class="tb-label tb-cell desc-label">
            @Html.LabelFor(model => model.description)
        </div>
        <div class="tb-field tb-cell desc-field">
            @Html.TextAreaFor(model => model.description, new { tabindex = "3", @class="desc-field" })
            @Html.ValidationMessageFor(model => model.description)
        </div>
    </div>
</div><!--tb-table description fields below-->
@Html.Partial("ManagerInfo")
@Html.Partial("AdministratorInfo")


<div id="workerDialog-@(Model.ID)" title="@Machete.Domain.Resources.WorkOrder.requestTitle">
    <table id="workerTable-@(Model.ID)" class="display" style="display: none">
        <thead>
            <tr>
                <th>EDITREF</th>
                <th>LABEL</th>
                <th>ID</th>
                <th>@Worker.dwccardnum</th>
                <th>@Worker.active</th>
                <th>@Person.firstname1</th>
                <th>@Person.firstname2</th>
                <th>@Person.lastname1</th>
                <th>@Person.lastname2</th>
                <th>@Worker.memberexpirationdate</th>
            </tr>
        </thead>
    </table>
    
</div>
<script language="javascript" type="text/javascript">
      function getRequests(myObj) {

//        $.getJSON("/WorkOrder/GetRequests", { "id": "@Model.ID" }, function (data) {
//            $(myObj).addItems(data);
//        });
        }
    $(document).ready(function () {
        dateTimeWidget($("#WO-dateTimeofWork-@(Model.ID)"));
        M_workerRequestTable_@(Model.ID) = $('#workerTable-@(Model.ID)').dataTable({
            "bPaginate": true,
            "bLengthChange": true,
            "aaSorting": [[9, 'desc']],
            "bFilter": true,
            "bSort": true,
            "bInfo": true,
            "iDeferLoading": true,
            "bAutoWidth": false,
            "bServerSide": true,
            "sAjaxSource": "/Worker/AjaxHandler", 
            "oLanguage": datatable_lang_@(CI.TwoLetterISOLanguageName),
            "bProcessing": true,
            "aoColumns": [
                { "mDataProp": "tabref","bSearchable": false, "bSortable": false, "bVisible": false },
                { "mDataProp": "tablabel","bSearchable": false, "bSortable": false, "bVisible": false },
                { "mDataProp": "WID","bSearchable": false, "bSortable": false, "bVisible": false },
                { "mDataProp": "dwccardnum" },
                { "mDataProp": "active" },
                { "mDataProp": "firstname1" },
                { "mDataProp": "firstname2" },
                { "mDataProp": "lastname1" },
                { "mDataProp": "lastname2" },
                { "mDataProp": "memberexpirationdate" }
            ],            
            "fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                $(nRow).attr('requestedID', aData['WID']);
                //$(nRow).attr('edittablabel', aData[1]);                
                return nRow;
            }                
        }).fnSetFilteringDelay(250);
        $(M_workerRequestTable_@(Model.ID)).find('tbody').dblclick(function (event) {            
            var myTr = event.target.parentNode;
            var myID = $(myTr).attr('requestedID');  
            var myLabel =  $(myTr).find('td:eq(0)').text() + ' '+
                                              $(myTr).find('td:eq(2)').text() + ' '+
                                              $(myTr).find('td:eq(4)').text();
          M_workerRequestHandler_@(Model.ID)(myID, myLabel);
            $('a.ui-dialog-titlebar-close').click();

        });
        //////////////////////////////////////////////////
        //
        //
        $('#workerDialog-@(Model.ID)').hide();
        $('#workerTable-@(Model.ID)').hide();
        //$("#wophone").mask("999-999-9999", { placeholder: " " });

        //////////////////////////////////////////////////
        //
        //
        $('#addRequestBtn-@(Model.ID)').click(function () {
            M_workerRequestTable_@(Model.ID).fnDraw();
            $('#workerTable-@(Model.ID)').show();
            M_workerRequestHandler_@(Model.ID) = function (myID, myLabel){
                //
                //Anon function to handle doubleclick of record selector
                $('#workerRequests2_WO-@(Model.ID)').append(
                    $('<option></option>').val(myID).html(myLabel)                
                );
            }
            $("#workerDialog-@(Model.ID)").dialog({
                    height: 340,
                    width: 1000,
                    modal: true
            });
            
            $('#workerDialog-@(Model.ID)').show();
        });
        //////////////////////////////////////////////////
        //
        //
        $('#removeRequestBtn-@(Model.ID)').click(function () {
            $('#workerRequests2_WO-@(Model.ID)').find('option:selected').remove();
        });
    });
</script>